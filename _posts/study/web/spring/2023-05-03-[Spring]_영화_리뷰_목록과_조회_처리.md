---
layout: post
title: "[Spring] 영화 리뷰 목록과 조회 처리"
subtitle: Spring
date: '2023-05-03 12:40:00 +0900'
category: study
tags: spring web
image:
    path: /assets/img/web/spring/logo.png
---

영화 리뷰의 목록과 조회를 처리해봅시다.

<!--more-->

* this unordered seed list will be replaced by the toc
{:toc}
<br>

영화 리뷰의 등록처리를 완료한 후 먼저 목록 페이지를 제작합니다. 목록 페이지에는 영화의 제목과 이미지, 평균 평점을 출력하고자 합니다.<br>

---
<br>

# 1. PageRequestDTO 추가
---
<br>

![1](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/1.png)
<br>

우선 화면에 목록과 페이지 처리를 위해 이저에 사용한 PageRequestDTO를 dto 패키지를 생성한 뒤 추가합니다.<br>


# 2. PageResultDTO 추가
---
<br>

![2](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/2.png)
<br>

PageResultDTO 역시 dto 패키지에 추가합니다.<br>


# 3. MovieRepository - getListPage() 작성
---
<br>

![3](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/3.png)
<br>

MovieRepository 인터페이스에 Movie 객체와 MovieImage 객체, 영화의 평균 평점과 리뷰를 Object[] 타입으로 반환하는 getListPage()를 작성합니다.<br>


# 4. MovieDTO - 평점, 리뷰 개수, 날짜 추가
---
<br>

![4](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/4m.png)
<br>

목록 화면 출력을 위한 getListPage()의 포맷에 맞게 MovieDTO를 수정합니다.<br>
double 타입의 avg, int 타입의 reviewCnt, LocalDateTime의 regDate, modDate를 작성합니다.<br>


# 5. MovieService - entitesToDTO() 작성
---
<br>

![5](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/5m.png)
<br>

MovieService에는 JPA를 통해 나온 엔티티 객체를 DTO로 변환하는 entitesToDTO()를 작성합니다.<br>
entitesToDTO()는 MovieImage 엔티티를 담는 List와 평점 평균, 리뷰 개수를 파라미터로 받아 MovieDTO로 컨버트합니다.

# 6. MovieServiceImpl - getList() 작성
---
<br>

![6](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/6m.png)
<br>

컨트롤러가 호출할 떄 사용할 getList()를 작성합니다. MovieService에 getList()를 먼저 선언한 뒤 Impl에 해당 메소드를 구현합니다.<br>
mno를 기준으로 내림차순 정렬하는 pageable을 만든 뒤 MovieRepository에서 엔티티를 꺼내와 Page에 가져옵니다. 가져온 엔티티는 Object[]에 담기며 각 인덱스의 자료형은 getListPage()의 결과값과 같습니다.<br>


# 7. 
---
<br>

![7](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/7m.png)
<br>



# 8. 
---
<br>

![8](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/8m.png)
<br>




# 9. 
---
<br>

![9](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/9m.png)
<br>



# 10. 
---
<br>

![10](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/10m.png)
<br>



# 11. 
---
<br>

![11](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/11m.png)
<br>



# 12. 
---
<br>

![12](/assets/img/web/spring/2023-05-03-[Spring]_영화_리뷰_목록과_조회_처리/12m.png)
<br>